<!DOCTYPE html>  <html> <head>   <title>faye-client-auth.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="app.html">                 app.coffee               </a>                                           <a class="source" href="backbone-faye-client-store.html">                 backbone-faye-client-store.coffee               </a>                                           <a class="source" href="faye-client-auth.html">                 faye-client-auth.coffee               </a>                                           <a class="source" href="jquery.image-dropout.html">                 jquery.image-dropout.coffee               </a>                                           <a class="source" href="backbone-faye-server-store.html">                 backbone-faye-server-store.coffee               </a>                                           <a class="source" href="faye.ad.html">                 faye.ad.coffee               </a>                                           <a class="source" href="server.html">                 server.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               faye-client-auth.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>The Auth </h2>

<p>The Auth  makes sure that the  communication going between the  server and the
client  uses a  validated account.  It monitors  all traffic  and will  reject
any  communiction that  does not  meet  the authentication  standards. If  the
authentication is successful then the auth class will allow communication over
the socket.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Connecting the auth class to the window</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">Auth = </span><span class="k">class</span> <span class="nx">Auth</span>
  <span class="nv">constructor: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Standard bindings using underscore</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;outgoing&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;errback&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Extension for faye.js.  This function will monitor all traffic  and send the
username and  password back  to the  server for  validation. If  the attempt
fails then it will try again. Otherwize it will enable the application</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">outgoing: </span><span class="nf">(message, callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Looking for the channel</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span> <span class="o">!=</span> <span class="s1">&#39;/meta/subscribe&#39;</span>
      <span class="k">return</span> <span class="nx">callback</span> <span class="nx">message</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>We found the channel and are now in authentication mode</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@request_auth</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Binding the auth class with the  given faye object, channel, and callback to
execute when there is data on the subscription</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bind: </span><span class="nf">(@bayeux,@channel,@callback) -&gt;</span>
    <span class="nx">@bayeux</span><span class="p">.</span><span class="nx">addExtension</span> <span class="err">@</span>
    <span class="nx">@connect_subscription</span><span class="p">()</span>
 </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>This will do the actual connecting/re-connecting to the channel.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">connect_subscription: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>If we already  have a subscription cancel  it ( remove the  listener ) and
create a new on</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@subscription</span><span class="o">?</span><span class="p">.</span><span class="nx">cancel</span><span class="p">()</span>
    <span class="vi">@subscription = </span><span class="nx">@bayeux</span><span class="p">.</span><span class="nx">subscribe</span> <span class="nx">@channel</span><span class="p">,</span> <span class="nx">@callback</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Hook  in callback  to  know  when the  subscription  has  connected or  be
rejected by the server</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@subscription</span><span class="p">.</span><span class="nx">callback</span> <span class="nx">@success</span>
    <span class="nx">@subscription</span><span class="p">.</span><span class="nx">errback</span> <span class="nx">@errback</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Auth failure handles retrying the </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">errback: </span><span class="nf">(err) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>simple alert the user on the error</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">alert</span> <span class="nx">err</span>
    <span class="nx">@connect_subscription</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><code>Unlock</code> the application</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">success: </span><span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.auth&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#create-equipment&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Grab the inventory  NOTE: Creating an event or callback  so that this does
not exists here would be good</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Inventory</span><span class="p">.</span><span class="nx">fetch</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>We are on the  correct channel and need to pass data to  the server. Here we
are waiting for an <code>enter</code> key to be pressed inorder to send the data to the
server</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">request_auth: </span><span class="nf">(message, callback) -&gt;</span>
    <span class="nv">message.ext = </span><span class="p">{}</span> <span class="nx">unless</span> <span class="nx">message</span><span class="p">.</span><span class="nx">ext</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
      <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">13</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>We are ready to authenticate. Load up  the message and send it away to
the server</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">message.ext.username = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#username&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nv">message.ext.password = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">callback</span> <span class="nx">message</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 